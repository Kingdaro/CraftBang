if not term.isColor() then return end

local prefsfile = '.cbprefs'
local prefs = {}
local args = {...}

local function firstrun()
	while true do
		print("This computer comes with a desktop environment!")
		print("Would you like to use the CraftBang desktop? [y/n]")

		local input = read():lower():sub(1,1)
		if input == 'y' or input == 'n' then
			if input == 'y' then
				prefs.autorun = true
				print("Thank you for choosing CraftBang!")
			else
				prefs.autorun = false
				print("Will boot into CraftOS.")
				print("Run craftbang/setup if you change your mind.")
			end

			local file = fs.open(prefsfile, 'w')
			file.write(textutils.serialize(prefs))
			file.close()

			print("Press any key to continue.")
			os.pullEvent('key')
			os.reboot()
		end
	end
end

if not fs.exists(prefsfile) or args[1] ~= 'firstrun' then
	firstrun()
else
	local file = fs.open(prefsfile, 'r')
	local content = file.readAll()
	file.close()

	prefs = textutils.unserialize(content) or {}
	if prefs.autorun == nil then
		firstrun()
	else
		if prefs.autorun == true then
			shell.run('craftbang/session')
		end
	end
end
